cmake_minimum_required(VERSION 3.13)

# Ensure PICO_SDK_PATH is set
if (NOT DEFINED ENV{PICO_SDK_PATH})
    message(FATAL_ERROR "PICO_SDK_PATH environment variable not set! Run: export PICO_SDK_PATH=/path/to/pico-sdk")
endif()

# Include the Pico SDK
include($ENV{PICO_SDK_PATH}/external/pico_sdk_import.cmake)

project(pico_http_server C CXX ASM)
set(CMAKE_C_STANDARD 11)
set(CMAKE_CXX_STANDARD 17)

# Initialize the Pico SDK
pico_sdk_init()

# Add executable
add_executable(server
    main.c
    src/request.c
    src/response.c
)

# Include directories
target_include_directories(server PRIVATE ${CMAKE_CURRENT_LIST_DIR}/inc)

# Define that we are building for the Pico
target_compile_definitions(server PRIVATE PICO_BUILD)

# Link against the necessary libraries
target_link_libraries(server pico_stdlib pico_cyw43_arch_lwip_sys)

# Generate .uf2 file for flashing onto the Pico
pico_add_extra_outputs(server)
